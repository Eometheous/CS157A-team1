<!DOCTYPE html>
<html>
<head>
  <title>Cart</title>
</head>
<link rel="stylesheet" href="../styles.css">
<script type="text/javascript" src="../sessionCheck.js"></script>
<body>
  <!-- NavBar -->
  <header>
    <h1> <a href="../index.html" style="width: 20%; text-decoration: none; color: #44cea4;">Flights GO</a></h1>
    <div class="hamburger">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>
    <nav class="nav-bar">
        <ul>
            <li>
                <a href="../flights/Cart.html">Cart</a>
            </li>
            <li>
                <a href="../user/LogOut.html">LogOut</a>
            </li>
            <li>
                <a href="../flights/FlightListings.html">Book</a>
            </li>
        </ul>
    </nav>
  </header>

  <div class="whatWeAre__list__second" style="margin-left: -3rem;">
    <ul>
      <li>
        <h1>Your Cart</h1>
      </li>
    </ul> 
  </div>
  <div class="flight__list"> 
    <p id="userId"></p>
    <li>   
      <script>
        window.onload = function() {
          fetch('../check_user.jsp')
            .then(response => response.json())
            .then(data => {
              const userId = data.iduser;
              console.log(userId);

              // Make a call to Cart.jsp with iduser parameter
              fetch(`./Cart.jsp?iduser=${userId}`)
                .then(response => response.json())
                .then(data => {
                  // Handle the data received from Cart.jsp and update the <p> tags
                  // Assuming the response data is an array of objects with 'cart_id', 'flight_id', 'plane', 'departing_airport', 'arriving_airport', 'departure_time', and 'arrival_time' properties
                  const cartItems = data;
                  const cartList = document.getElementById('cartList');

                  cartItems.forEach(item => {
                    const cartItem = document.createElement('li');
                    cartItem.innerHTML = `
                      <p> Cart ID: ${item.cart_id}</p> 
                      <p> Flight ID: ${item.flight_id}</p> 
                      <p> Plane: ${item.plane} </p>
                      <p> Departing Airport: ${item.departing_airport}</p>
                      <p> Arriving Airport: ${item.arriving_airport}</p>
                      <p> Departure Time: ${item.departure_time}</p> 
                      <p> Arrival Time: ${item.arrival_time}</p>
                      <form action="RemoveFromCart.jsp?cart_id=${item.cart_id}" method="post" id="RemoveFromCartForm">
                        <input style="width: 8rem; text-align: center;" type="submit" value="Remove From Cart" name="RemoveFromCartButton" id="RemoveFromCartBut">
                      </form>
                      <hr>
                    `;
                    cartList.appendChild(cartItem);
                  });
                })
                .catch(error => {
                  console.error('Error occurred:', error);
                  // Handle any errors that occurred during the fetch
                });
            })
            .catch(error => {
              console.error('Error occurred:', error);
              // Handle any errors that occurred during the fetch
            });
        };
      </script>
    </li>
    <ul id="cartList"></ul> <!-- Add an empty list to display cart items -->
  </div>
</body>
</html>

